function onDeviceReady(){function init(){if(loadSettings(),changeGlobalTheme(1==fbUITheme?"a":"b"),startIscroll(),createDeckMenu(),localStorage.selecteddecks){var decksplit=localStorage.selecteddecks.split(",");restoreSavedDecks(decksplit)}try{eval(fbTheme)}catch(e){console.log(e.message),fbTheme=defaultThemeName}var ua=navigator.userAgent.toLowerCase();if(isAndroid=ua.indexOf("android")>-1,isAndroid&&(androidVersion=parseFloat(getAndroidVersion()),badAndroidFlag=!1,4.1==androidVersion||4.2==androidVersion||4.3==androidVersion)){badAndroidFlag=!0;var clickThreshold=500;last_click_time=(new Date).getTime(),document.addEventListener("click",function(e){return click_time=e.timeStamp,click_time&&click_time-last_click_time<clickThreshold?(e.stopImmediatePropagation(),e.preventDefault(),!1):void(last_click_time=click_time)},!0),setTimeout(function(){$(".animationUI").hide(),$("#fbAnimation").val(100),readUiSettings()},500)}setTimeout(function(){currentTheme=eval(fbTheme),drawFlag=!1,bglog.resizeCanvas(),bglog.loadTheme(currentTheme),applySettings(),drawFlag=!0,bglog.drawAllLayers()},100),markSettings(),window.isphone&&setTimeout(function(){navigator.splashscreen.hide()},0),"True"==fbCoach&&setTimeout(function(){$("body").chardinJs("start")},100)}function getAndroidVersion(e){var e=e||navigator.userAgent,t=e.match(/Android\s([0-9\.]*)/);return t?t[1]:!1}function initStore(){if(window.isphone){if(!window.store)return void alert("Store not available");store.verbosity=store.DEBUG,store.register({id:productPrefix+"4",alias:"Opening Replies",type:store.NON_CONSUMABLE}),store.error(function(){$("#loading").html("<strong>Unable to reach the store.</strong><br>Please check your internet connection and try again.")}),store.when("product").approved(function(e){e.finish()}),store.when("product").owned(function(e){var t=e.id.split(".")[1];afterBuy(t)}),store.ready(function(){$("#loading").html("<strong>Decks available for purchase:</strong>");var e=store.get(productPrefix+"4");$("#buying4").text(""+e.alias),$("#price4").text(""+e.price)}),store.refresh(),sessionStorage.storeInit="Initialized"}else $("#loading").html("<strong>Not on device. Cannot load store.</strong>")}function startIscroll(){if(window.isphone){var e=navigator.userAgent.toLowerCase();-1==e.indexOf("android")&&($(".willScroll").attr("data-iscroll",""),$("[data-iscroll]").iscrollview(),$("[data-iscroll]").iscrollview("refresh"))}}function createDeckMenu(){for(var e=DeckSet.length;e>0;e--){i=e-1;var t='<fieldset data-role="collapsible" data-corners="false" class="decksetclass" id="'+DeckSet[i].DeckSetName+'"><legend data-position="inline">'+DeckSet[i].DeckSetName+'<span style="float:right;" class="button-span"><a id="buyButton'+i+'" class="ui-btn ui-btn-icon-notext ui-icon-lock ui-corner-all buyButton metaButton" style="float:right"></a><a id="infoButton'+i+'" style="float:right; margin-right: 10px;" class="ui-btn ui-btn-icon-notext ui-icon-info ui-corner-all infoButton metaButton"></a></span></legend><div data-role="controlgroup" data-corners="false" class="insidedecksetclass" id="Inside'+i+'"></div></fieldset>';$(t).prependTo("#selectDeckForm");for(var o=[0,1,2,3,4,5,6,7,8,18,9,10,11,12,13,14,15,16,17],n=0;n<o.length;n++)if(Deck[o[n]].DeckSetID==i){var a='<input type="checkbox" name="Deck'+o[n]+'" id="Deck'+o[n]+'" /><label for="Deck'+o[n]+'">'+Deck[o[n]].DeckName+"</label>";$(a).appendTo("#Inside"+i)}}$(".insidedecksetclass").enhanceWithin(),$(".insidedecksetclass").controlgroup({corners:!1}),$(".decksetclass").collapsible();for(var r=0;r<DeckSet.length;r++)if(0==fbDeckSetForSale[r]){$("#buyButton"+r).removeClass("ui-icon-lock"),$("#buyButton"+r).addClass("ui-icon-check"),$("#buyButton"+r).addClass("ui-disabled"),$("#buying"+r).addClass("ui-disabled");for(var c=0;c<Deck.length;c++)Deck[c].DeckSetID==r&&1==Deck[c].IsSample&&($('label[for="Deck'+c+'"]').css("display","none"),$("#Deck"+c).css("display","none"))}else for(var c=0;c<Deck.length;c++)Deck[c].DeckSetID==r&&0==Deck[c].IsSample&&$("#Deck"+c).checkboxradio("disable");$(".infoButton").click(function(){var e=this.id;e=e.replace(/^\D+/g,"");for(var t=0;t<Deck.length;t++)if(Deck[t].DeckSetID==e){$("body").pagecontainer("change","#hint"+t,{transition:"slide"});break}return!1}),$(".buyButton").click(function(){return openStore(),!1})}function afterBuy(e){$("#buying"+e).addClass("ui-disabled"),$("#buyButton"+e).removeClass("ui-icon-lock"),$("#buyButton"+e).addClass("ui-icon-check"),$("#buyButton"+e).addClass("ui-disabled"),localStorage["fbDeckSetForSale"+e]="false";for(var t=0;t<Deck.length;t++)Deck[t].DeckSetID==e&&(1==Deck[t].IsSample?($("#Deck"+t).prop("checked",!1).checkboxradio("refresh"),$('label[for="Deck'+t+'"]').css("display","none"),$("#Deck"+t).css("display","none")):$("#Deck"+t).checkboxradio("enable"))}function restorePurchases(){if(window.isphone&&store.refresh(),"false"===localStorage.fbDeckSetForSale4)var e=setInterval(function(){$("#purchasesRestored").popup("open"),clearInterval(e)},1);else var e=setInterval(function(){$("#noPurchases").popup("open"),clearInterval(e)},1)}function loadSettings(){localStorage.fbCoach&&(fbCoach=localStorage.fbCoach),localStorage.fbTheme&&(fbTheme=localStorage.fbTheme),localStorage.fbAnimation&&(fbAnimation=Number(localStorage.fbAnimation)),"false"==localStorage.fbDirection&&(fbDirection=!1),"false"==localStorage.fbUITheme&&(fbUITheme=!1),"false"==localStorage.fbShowDice&&(fbShowDice=!1),"false"==localStorage.fbShowPipcount&&(fbShowPipcount=!1),"false"==localStorage.fbShowPointNumbers&&(fbShowPointNumbers=!1,console.log("fbShowPointNumbers = "+fbShowPointNumbers+" "+typeof fbShowPointNumbers)),"false"==localStorage.fbShowTakiPoints&&(fbShowTakiPoints=!1);for(var e=0;e<DeckSet.length;e++)"false"===localStorage["fbDeckSetForSale"+e]?fbDeckSetForSale[e]=!1:"true"===localStorage["fbDeckSetForSale"+e]?fbDeckSetForSale[e]=!0:(fbDeckSetForSale[e]=!!DeckSet[e].IsForSale,localStorage["fbDeckSetForSale"+e]=fbDeckSetForSale[e].toString())}function markSettings(){setTimeout(function(){$("#settings").page(),$("input:radio[name='fbTheme']").each(function(){$(this).prop("checked",!1)}),$("input:radio[name='fbTheme'][value ='"+fbTheme+"']").prop("checked",!0).checkboxradio("refresh"),$("input:radio[name='fbDirection']").each(function(){$(this).prop("checked",!1)}),$("input:radio[name='fbDirection'][value ='"+fbDirection+"']").prop("checked",!0).checkboxradio("refresh"),$("input:radio[name='fbUITheme']").each(function(){$(this).prop("checked",!1)}),$("input:radio[name='fbUITheme'][value ='"+fbUITheme+"']").prop("checked",!0).checkboxradio("refresh"),$("#fbShowDice").prop("checked",fbShowDice).checkboxradio("refresh"),$("#fbShowPipcount").prop("checked",fbShowPipcount).checkboxradio("refresh"),$("#fbShowPointNumbers").prop("checked",fbShowPointNumbers).checkboxradio("refresh"),$("#fbShowTakiPoints").prop("checked",fbShowTakiPoints).checkboxradio("refresh"),$("#fbAnimation").slider(),$("#fbAnimation").val(100-50*fbAnimation),$("#fbAnimation").slider("refresh")},200)}function readUiSettings(){console.log("Reading Settings"),themeChangeFlag=!1,settingsChangeFlag=!1;var e=$('input[name="fbTheme"]:checked').val();console.log("Theme: "+typeof e+e),fbTheme!=e&&(fbTheme=e,localStorage.fbTheme=fbTheme,themeChangeFlag=!0);var t=(100-$("#fbAnimation").val())/50;console.log("Animation: "+t),fbAnimation!=t&&(fbAnimation=t,localStorage.fbAnimation=""+fbAnimation,settingsChangeFlag=!0);var o=$('input[name="fbDirection"]:checked').val();o="true"==o?!0:!1,console.log("Direction: "+typeof o+o),fbDirection!=o&&(fbDirection=o,console.log("fbDirection saved as "+fbDirection),localStorage.fbDirection=""+fbDirection,settingsChangeFlag=!0);var n=$('input[name="fbUITheme"]:checked').val();n="true"==n?!0:!1,console.log("UITheme: "+typeof n+n),fbUITheme!=n&&(fbUITheme=n,console.log("fbUITheme saved as "+fbUITheme),localStorage.fbUITheme=""+fbUITheme,settingsChangeFlag=!0);var a=$("#fbShowDice").is(":checked");console.log("Dice: "+typeof a+a),fbShowDice!=a&&(fbShowDice=a,localStorage.fbShowDice=""+fbShowDice,settingsChangeFlag=!0);var r=$("#fbShowPipcount").is(":checked");console.log("Pips: "+typeof r+r),fbShowPipcount!=r&&(fbShowPipcount=r,localStorage.fbShowPipcount=""+fbShowPipcount,settingsChangeFlag=!0);var i=$("#fbShowPointNumbers").is(":checked");console.log("Points: "+typeof i+i),fbShowPointNumbers!=i&&(fbShowPointNumbers=i,localStorage.fbShowPointNumbers=""+fbShowPointNumbers,settingsChangeFlag=!0);var c=$("#fbShowTakiPoints").is(":checked");console.log("Taki: "+typeof c+c),fbShowTakiPoints!=c&&(fbShowTakiPoints=c,localStorage.fbShowTakiPoints=""+fbShowTakiPoints,settingsChangeFlag=!0),console.log("settingsChangeFlag = "+settingsChangeFlag),console.log("themeChangeFlag = "+themeChangeFlag),drawFlag=!1,themeChangeFlag?(changeTheme(fbTheme),applySettings()):settingsChangeFlag&&applySettings(),themeChangeFlag=!1,settingsChangeFlag=!1,drawFlag=!0,bglog.drawAllLayers(),$.mobile.back()}function applySettings(){changeAnimation(fbAnimation),changeDirection(fbDirection),changeUITheme(fbUITheme),changeDice(fbShowDice),changePipCount(fbShowPipcount),changePointNumbers(fbShowPointNumbers),changeTakiPoints(fbShowTakiPoints)}function changeTheme(themeName){console.log("Changing theme"),swapSidesFlag&&bglog.swapSides(),bglog.loadTheme(eval(themeName)),showQuestion()}function changeAnimation(e){bglog.setAnimationSpeed(e)}function changeDirection(e){currentTheme.direction=1==e?!1:!0,bglog.toggleDirection()}function changeUITheme(e){1==e?(background.setFill("#F2F2F2"),allText.setFill("#000000"),$(".ui-page").css("background-color","#F2F2F2"),changeGlobalTheme("a")):(background.setFill("#2a2a2a"),allText.setFill("#ffffff"),$(".ui-page").css("background-color","#2a2a2a"),changeGlobalTheme("b"))}function changePipCount(e){currentTheme.showPipCount=1==e?!1:!0,(1==e||0==showingAnswer)&&bglog.togglePipCount()}function changeDice(e){currentTheme.showDice=1==e?!1:!0,bglog.toggleDice()}function changePointNumbers(e){currentTheme.showPointNumbers=1==e?!1:!0,bglog.toggleShowNumbers()}function changeTakiPoints(e){currentTheme.takiPoints=1==e?!1:!0,bglog.toggletakiPoints()}function restoreSavedDecks(e){for(var t=0;t<e.length;t++)restoreSavedDeck(e[t])}function restoreSavedDeck(e){$(e).prop("checked",!0).checkboxradio("refresh")}function clearTrainingKeys(){for(var e in localStorage)isTrainingKey(e)&&delete window.localStorage[e];$("#ConfirmClearTraining").popup("open"),clearTrainingFlag=!0,selectDecks(),showStats()}function isTrainingKey(e){return e.indexOf("train")>-1}function showStats(){$("#stattext").empty(),$("body").pagecontainer("change","#stats",{transition:"pop"});for(var e="",t=0;t<checked.length;t++)e=checked[t].replace(/^\D+/g,""),0==t?(statrow="<tr><td width = '180'><b>Selected Decks: </b></td><td colspan='2'>"+Deck[e].DeckName+"</td></tr>",$("#stattext").append(statrow)):(statrow="<tr><td> </td><td colspan='2'>"+Deck[e].DeckName+"</td></tr>",$("#stattext").append(statrow));statrow="<tr><td></td><td width = '10'></td></tr>",$("#stattext").append(statrow),$("#stattext").append(statrow);var o=unseencount+learnedcount+trainingcount;statrow="<tr><td><b>Selected Cards: </b></td><td>"+o+"</td></tr>",$("#stattext").append(statrow),statrow="<tr><td> </td></tr>",$("#stattext").append(statrow),$("#stattext").append(statrow);for(var t=0;8>t;t++)0==t?(statrow="<tr><td>Unseen cards: </td><td>"+currentcards[t].length+"</td></tr><tr></tr>",$("#stattext").append(statrow)):7==t?(statrow="<tr></tr><tr><td>Learned cards: </td><td>"+currentcards[t].length+"</td></tr>",$("#stattext").append(statrow)):(statrow="<tr><td>Cards in group "+t+":</td><td>&nbsp</td><td>"+currentcards[t].length+"</td></tr>",$("#stattext").append(statrow))}function showloader(e,t){$("#"+e).spin("custom","black"),setTimeout(function(){t(),$("#"+e).spin(!1)},0)}function selectDecks(){checked.length=0,selecteddecks.length=0;for(var e=0;e<Deck.length;e++)1==$("#Deck"+e).prop("checked")&&(checked.push("Deck"+e),selecteddecks.push("#Deck"+e));0==checked.length?$("#NoneSelectedPopup").popup("open"):selectCards(),localStorage.selecteddecks=""+selecteddecks.toString()}function selectCards(){browselist=[];for(var e=0;e<Card.length;e++)decklist in Card[e]&&(card[e].decklist.length=0),hintlist in Card[e]&&(card[e].hintlist.length=0);for(var e=0;8>e;e++)currentcards[e].length=0;for(var e=0;e<CardInDeck.length;e++)checked.indexOf("Deck"+CardInDeck[e].DeckID)>-1&&(decklist in Card[CardInDeck[e].CardID]||(Card[CardInDeck[e].CardID].decklist=[]),Card[CardInDeck[e].CardID].decklist.push(CardInDeck[e].DeckID),hintlist in Card[CardInDeck[e].CardID]||(Card[CardInDeck[e].CardID].hintlist=[]),Card[CardInDeck[e].CardID].hintlist.push(CardInDeck[e].DeckHintPointer),browselist[browselist.length]=Card[CardInDeck[e].CardID],localStorage["train"+e]?(train=Number(localStorage["train"+e]),Card[CardInDeck[e].CardID].trainval=train,currentcards[train][currentcards[train].length]=Card[CardInDeck[e].CardID]):(train=0,Card[CardInDeck[e].CardID].trainval=0,currentcards[0][currentcards[0].length]=Card[CardInDeck[e].CardID]));console.log("Browselist length: "+browselist.length),0==clearTrainingFlag?loadCard():clearTrainingFlag=!1}function loadCard(){$("body").pagecontainer("change","#flashcards",{transition:"pop"}),undo(),browseMode?browsecard():(choosecard(),lastcard=chosencard.CardID),chooseposition(),$("#questioncontainer").css("text-align","left"),$("#questioncontainer").removeClass("ui-icon-minus"),$("#questioncontainer").addClass("ui-icon-plus"),0==fbShowPipcount&&1==showingAnswer&&bglog.togglePipCount(),swapSidesFlag&&bglog.swapSides(),$("#belowAnswerContainer").show(),0==chosencard.CardKind?$("#swapButton").show():$("#swapButton").hide(),chosencard.CardKind>1?$("#bglogContainer").slideUp():($("#bglogContainer").slideDown(),bglog.loadXgId("XGID="+chosenposition.XGID)),$("#outerAnswerContainer").hide(),showingAnswer=!1,$("[data-role='header'] h1").text(""+Deck[chosencard.decklist[0]].DeckName),showQuestion(),showAnswer()}function showQuestion(){var e=currentTheme.ourCheckerColorText,t="",o="",n="";if(2==chosencard.CardKind)chosenposition.iNeed>chosenposition.youNeed?n=" leads: ":chosenposition.iNeed<chosenposition.youNeed?n=" trails: ":(n=" is even: ",e="Match"),(-1==chosenposition.iNeed||-1==chosenposition.youNeed)&&(t=", Crawford"),o=e+n+chosenposition.iNeed+", "+chosenposition.youNeed+t+".","TP"==chosenposition.Concepttype&&(questiontext=o+"<br>"+currentTheme.ourCheckerColorText+" is doubled to "+chosenposition.Cube+".  Take point?"),"MWC"==chosenposition.Concepttype&&(questiontext=o+"<br>Match Winning Chances?");else if(3==chosencard.CardKind)for(questiontext="<p style='text-align:center'>"+chosenposition.RuleName+":<br>",i=0;i<chosenposition.Subrules.length;i++)questiontext=questiontext.concat(String.fromCharCode(65+i)+". ");else{if(0==matchLength)o="Money game.";else{var a=ourScore-matchLength,r=oppScore-matchLength;n=ourScore>oppScore?"leads:":ourScore<oppScore?"trails:":"is even:",t=crawfordFlag?", Crawford":"",o=" "+currentTheme.ourCheckerColorText+" "+n+" "+a+", "+r+t+"."}if(0==chosencard.CardKind)questiontext=currentTheme.ourCheckerColorText+" on roll, Cube Action?<br>"+o;else if(1==chosencard.CardKind){if(chosencard.CardID>2749&&chosencard.CardID<5270)var c=getOpeningPlay();else var c=".<br>";questiontext=currentTheme.ourCheckerColorText+" to play "+leftDie+rightDie+c+o}}$("#questioncontainer").html(questiontext)}function getOpeningPlay(){var e=["21$","21S","31P","41$","41S","51$","51S","61P","32D","32S","32Z","42P","52D","52S","62$","62R","62S","43D","43S","43U","43Z","53P","63R","63S","54D","54S","64P","64R","64S","65R"],t=Math.ceil((chosencard.CardID-2749)%630/21),o=e[t-1],n=" after "+o+".<br>";return n}function showAnswer(){$(".answerContainer div .iscroll-content").empty(),0==chosencard.CardKind?showCubeAnswer():1==chosencard.CardKind?showPlayAnswer():2==chosencard.CardKind?showConceptAnswer():3==chosencard.CardKind&&showRuleAnswer();for(var e="",t=0;t<answertext.length;t++)e+=answertext[t];e+="<br><br><br><br><br><br><br><br><br><br><br><br>",$(".answerContainer div .iscroll-content").append(e),$(".answerContainer").iscrollview("scrollTo",0,0,0,!1),$(".movebutton").click(function(){return $(".movebutton").not(this).addClass("ui-disabled"),$(this).removeClass("ui-icon-carat-r"),$(this).addClass("ui-icon-carat-l"),animate($(this).text()),!1})}function toggleAnswerContainer(){0==fbShowPipcount&&bglog.togglePipCount(),showingAnswer?($("#outerAnswerContainer").hide(),$("#belowAnswerContainer").show(),$("#questioncontainer").removeClass("ui-icon-minus"),$("#questioncontainer").addClass("ui-icon-plus"),showingAnswer=!1):($("#outerAnswerContainer").show(),$("#belowAnswerContainer").hide(),$("#questioncontainer").removeClass("ui-icon-plus"),$("#questioncontainer").addClass("ui-icon-minus"),showingAnswer=!0),$(".answerContainer").iscrollview("refresh")}function showCubeAnswer(){return answertext=[],cubeDataNum=getCubeData(),cubeActions=getCubeActions(cubeDataNum),cubeData=formatCubeData(cubeDataNum,cubeActions),cubeOutcomes=getCubeOutcomes(),answertext[answertext.length]="<table><tr><td width='130'></td><td width='65'></td><td width='65'></td><td></td></tr>",matchLength>0&&(answertext[answertext.length]="<tr><td><b>Score:</b></td><td colspan='3' style='text-align:left'><b>"+cubeActions.scoreDouble+" / "+cubeActions.scoreTake+"</b></td></tr>",answertext[answertext.length]="<tr><td>No Double</td><td>"+cubeData.scoreND+"</td><td>"+cubeData.scoreNDEr+"</tr>",answertext[answertext.length]="<tr><td>Double/Take</td><td>"+cubeData.scoreDT+"</td><td>"+cubeData.scoreDTEr+"</tr>",answertext[answertext.length]="<tr><td>Double/Pass</td><td>+1.000</td><td>"+cubeData.scoreDPEr+"</tr>",answertext[answertext.length]="<tr><td colspan='100'><hr></td></tr><tr></tr>"),answertext[answertext.length]="<tr><td><b>Money:</b></td><td colspan='3' style='text-align:left'><b>"+cubeActions.moneyCombo+" / "+cubeActions.moneyTake+"</b></td></tr>","No Double (Redouble)"==cubeActions.moneyCombo&&(answertext[answertext.length]="<tr><td></td><td colspan='3' style='text-align:left'><b>Lotto Paradox!</b></td></tr>"),answertext[answertext.length]="<tr><td><b>W:</b> "+cubeOutcomes.PlainW+" ("+cubeOutcomes.GammonW+", "+cubeOutcomes.BackgammonW+")</td><td colspan='3'><b>L:</b> "+cubeOutcomes.PlainL+" ("+cubeOutcomes.GammonL+", "+cubeOutcomes.BackgammonL+")</td></tr>",answertext[answertext.length]="<tr><td>No Double</td><td>"+cubeData.moneyND+"</td><td>"+cubeData.moneyNDEr+"</tr>",answertext[answertext.length]="<tr><td>No Redouble</td><td>"+cubeData.moneyNRD+"</td><td>"+cubeData.moneyNRDEr+"</tr>",answertext[answertext.length]="<tr><td>Double/"+cubeActions.moneyTakeString+"</td><td>"+cubeData.moneyDT+"</td><td>"+cubeData.moneyDTEr+"</tr>",answertext[answertext.length]="<tr><td>Double/Pass</td><td>+1.000</td><td>"+cubeData.moneyDPEr+"</tr></table>",answertext}function getCubeOutcomes(){var e=[];return e.PlainW=Outcome[0][chosenposition.positionIndex].PlainW,e.GammonW=Outcome[0][chosenposition.positionIndex].GammonW,e.BackgammonW=Outcome[0][chosenposition.positionIndex].BackgammonW,e.PlainL=Outcome[0][chosenposition.positionIndex].PlainL,e.GammonL=Outcome[0][chosenposition.positionIndex].GammonL,e.BackgammonL=Outcome[0][chosenposition.positionIndex].BackgammonL,e}function getCubeData(){for(var e=[],t=0,o=CubeCard[chosencard.CardID].length;o>t;t++)0==CubePosition[CubeCard[chosencard.CardID][t]].Score1?(e.moneyDT=CubePosition[CubeCard[chosencard.CardID][t]].DTEq,0==CubePosition[CubeCard[chosencard.CardID][t]].CubeOwner?e.moneyND=CubePosition[CubeCard[chosencard.CardID][t]].NDEq:e.moneyNRD=CubePosition[CubeCard[chosencard.CardID][t]].NDEq):(e.scoreND=CubePosition[CubeCard[chosencard.CardID][t]].NDEq,e.scoreDT=CubePosition[CubeCard[chosencard.CardID][t]].DTEq);return e.moneyNDEr=(e.moneyND-Math.min(e.moneyDT,1)).toFixed(3),e.moneyNRDEr=(e.moneyNRD-Math.min(e.moneyDT,1)).toFixed(3),e.scoreNDEr=(e.scoreND-Math.min(e.scoreDT,1)).toFixed(3),e.moneyDPEr=e.moneyNRD>1?(1-e.moneyNRD).toFixed(3):(1-e.moneyDT).toFixed(3),e.scoreDPEr=e.scoreND>1?(1-e.scoreND).toFixed(3):(1-e.scoreDT).toFixed(3),e.moneyDTEr=e.moneyDT>1?(e.moneyDT-Math.max(e.moneyNRD,1)).toFixed(3):(e.moneyDT-e.moneyNRD).toFixed(3),e.scoreDTEr=e.scoreDT>1?(e.scoreDT-Math.max(e.scoreND,1)).toFixed(3):(e.scoreDT-e.scoreND).toFixed(3),e}function formatCubeData(e,t){for(datum in e)e[datum]=e[datum]>=0?"+"+e[datum]:"- "+-1*e[datum];return"Pass"==t.moneyTake&&("Too Good"==t.moneyReDouble?e.moneyNRDEr="":e.moneyDPEr=""),"Beaver"==t.moneyTake&&(e.moneyNDEr="",e.moneyNRDEr=""),"Take"==t.moneyTake&&(("Double"==t.moneyDouble||"Redouble"==t.moneyReDouble)&&(e.moneyDTEr=""),"No Double"==t.moneyDouble&&(e.moneyNDEr=""),"No Redouble"==t.moneyReDouble&&(e.moneyNRDEr="")),"Too Good"==t.moneyDouble&&(e.moneyNRDEr=""),"Pass"==t.scoreTake&&("Too Good"==t.scoreDouble?e.scoreNDEr="":e.scoreDPEr=""),"Take"==t.scoreTake&&("Double"==t.scoreDouble?e.scoreDTEr="":e.scoreNDEr=""),""!=e.moneyNRDEr&&(e.moneyNRDEr="("+e.moneyNRDEr+")"),""!=e.moneyNDEr&&(e.moneyNDEr="("+e.moneyNDEr+")"),""!=e.moneyDTEr&&(e.moneyDTEr="("+e.moneyDTEr+")"),""!=e.moneyDPEr&&(e.moneyDPEr="("+e.moneyDPEr+")"),""!=e.scoreNDEr&&(e.scoreNDEr="("+e.scoreNDEr+")"),""!=e.scoreDTEr&&(e.scoreDTEr="("+e.scoreDTEr+")"),""!=e.scoreDPEr&&(e.scoreDPEr="("+e.scoreDPEr+")"),e}function getCubeActions(e){var t=[];return t.moneyReDouble=e.moneyNRD<e.moneyDT?e.moneyNRD>1?"Too Good":"Redouble":"No Redouble",t.moneyDouble=e.moneyND<e.moneyDT?"Double":"No Double",t.moneyCombo="No Double"==t.moneyDouble?"No Redouble"==t.moneyReDouble?"No (Re)Double":"No Double (Redouble)":"No Redouble"==t.moneyReDouble?"Double (No Redouble)":"Redouble"==t.moneyReDouble?"(Re)Double":"Double (Too Good)",e.moneyDT>=1?(t.moneyTake="Pass",t.moneyTakeString="Take"):e.moneyDT<0?(t.moneyTake="Beaver",t.moneyTakeString="Beaver"):(t.moneyTake="Take",t.moneyTakeString="Take"),t.scoreDouble=e.scoreND<e.scoreDT?e.scoreND>1?"Too Good":"Double":"No Double",t.scoreTake=e.scoreDT>=1?"Pass":"Take",t}function showPlayAnswer(){if(answertext=[],answertext[answertext.length]="<table cellpadding='0' cellspacing='0'><tr><td width='60'></td><td width='150'></td><td width='20'></td><td></td><td></td></tr>",matchLength>0){{getPlayResults(chosenposition.positionIndex,"Score")}answertext[answertext.length]="<tr><td colspan='100'><hr></td></tr><tr></tr>";var e=getPlayResults(getMoneyPlayPosition(),"Money");answertext=e,answertext[answertext.length]="</table>"}else{var t=getPlayResults(chosenposition.positionIndex,"Money");answertext=t,answertext[answertext.length]="</table>"}return answertext}function getPlayResults(e,t){for(var o=0,n=Object.keys(Play[e]).length;n>o;o++)if(0==o){var a="",r=Play[e][o].PlayString,i=Play[e][o].PlayEquity;Play[e][o].PlayEquity<0&&(a="-",i=Math.abs(i)),answertext[answertext.length]="<tr><td><strong>"+t+":&nbsp;</strong></td><td><div class='ui-btn ui-mini ui-icon-carat-r ui-btn-icon-right ui-corner-all movebutton' style='width:70%;text-align:left;margin:3px;'>"+r+"</div></td><td></td><td>"+a+"</td><td><strong>"+i+"</strong></td></tr>"}else{var c=Play[e][0].PlayEquity-Play[e][o].PlayEquity,s=c.toFixed(3),d="";c>.01&&(d="green"),c>.1&&(d="red"),answertext[answertext.length]="<tr><td></td><td><div class='ui-btn ui-mini ui-icon-carat-r ui-btn-icon-right ui-corner-all movebutton' style='width:70%;text-align:left;margin:3px'>"+Play[e][o].PlayString+"</div></td><td></td><td style='color:"+d+"'>(-</td><td style='color:"+d+"'>"+s+")</td></tr>"}return answertext}function getMoneyPlayPosition(){for(var e in PlayCard[chosencard.CardID])if(0==PlayPosition[PlayCard[chosencard.CardID][e]].Score1)return PlayCard[chosencard.CardID][e]}function showConceptAnswer(){return answertext=[],"TP"==chosenposition.Concepttype?(answertext[answertext.length]="<table><tr><td width='100'></td><td width='150'></td><td></td></tr>",answertext[answertext.length]="<tr><td><b>Take Point:</b></td><td><b>Dead Cube</b></td><td><b>Live Cube</b></td></tr>",answertext[answertext.length]="<tr><td></td><td>"+chosenposition.Dead+"%</td><td>"+chosenposition.Live+"%</td></tr></table>"):"MWC"==chosenposition.Concepttype&&(answertext[answertext.length]="<table><tr><td width='100'></td><td width='150'></td><td></td></tr>",answertext[answertext.length]="<tr><td><b>MWC:</b></td><td>"+chosenposition.Dead+"%</td><td></td></tr></table>"),answertext}function showRuleAnswer(){for(answertext=[],answertext[answertext.length]="<table width='90%'><tr><td width='25'></td><td></td></tr>",answertext[answertext.length]="<tr><td></td><td><b>"+chosenposition.RuleText+"</b></td></tr><tr><td colspan='100'><hr></td></tr><tr></tr>",i=0;i<chosenposition.Subrules.length;i++)answertext[answertext.length]="<tr><td style='vertical-align:top'><b>"+String.fromCharCode(65+i)+".</b></td><td style='vertical-align:top'>"+chosenposition.Subrules[i]+"</td></tr>";return answertext[answertext.length]="</table>",answertext}function chooseposition(){0==chosencard.CardKind?(chosenposition=jQuery.extend(!0,{},CubePosition[CubeCard[chosencard.CardID][0]]),chosenposition.positionIndex=CubeCard[chosencard.CardID][0],$("#swapButton").show()):1==chosencard.CardKind?(chosenposition=jQuery.extend(!0,{},PlayPosition[PlayCard[chosencard.CardID][0]]),chosenposition.positionIndex=PlayCard[chosencard.CardID][0],$("#swapButton").hide()):2==chosencard.CardKind?(chosenposition=jQuery.extend(!0,{},ConceptCard[chosencard.CardID]),chosenposition.positionIndex=chosencard.CardID):3==chosencard.CardKind&&(chosenposition=jQuery.extend(!0,{},RuleCard[chosencard.CardID]),chosenposition.positionIndex=chosencard.CardID)}function browsecard(){chosencard={},randomcard=Math.floor(Math.random()*browselist.length),chosencard=jQuery.extend(!0,{},browselist[randomcard])}function choosecard(){do if(traingroup=choosegroup(),chosencard={},"Unseen"==traingroup)randomcard=Math.floor(Math.random()*unseencount),chosencard=jQuery.extend(!0,{},currentcards[0][randomcard]);else if("Learned"==traingroup)randomcard=Math.floor(Math.random()*learnedcount),chosencard=jQuery.extend(!0,{},currentcards[7][randomcard]);else{var e=[];e[0]=0;for(var t=0,o=1;7>o;o++)e[o]=e[o-1]+currentcards[o].length*(7-o);t=Math.floor(Math.random()*e[6]+1);for(var o=1;7>o;o++)if(t<=e[o]){randomcard=Math.floor(Math.random()*currentcards[o].length),chosencard=jQuery.extend(!0,{},currentcards[o][randomcard]);break}}while(chosencard.CardID==lastcard)}function choosegroup(){traingroup="",unseencount=currentcards[0].length,learnedcount=currentcards[7].length,trainingcount=0;for(var e=1;7>e;e++)trainingcount+=currentcards[e].length;return 0==unseencount?0==trainingcount?0==learnedcount?$("body").pagecontainer("change","#checkbox"):traingroup="Learned":traingroup=0==learnedcount?"Training":Math.random()<.95?"Training":"Learned":traingroup=trainingsizelow>trainingcount?"Unseen":trainingsizehigh>trainingcount?Math.random()<.5?"Training":"Unseen":0==learnedcount?"Training":Math.random()<.95?"Training":"Learned",traingroup}function iseasy(){checkerTweenActive||(7==chosencard.trainval?newtrainval=chosencard.trainval:(oldtrainval=chosencard.trainval,newtrainval=chosencard.trainval+1,localStorage["train"+chosencard.CardID]=""+newtrainval,0==browseMode&&(currentcards[chosencard.trainval][randomcard].trainval=newtrainval,currentcards[newtrainval].push(currentcards[chosencard.trainval][randomcard]),currentcards[oldtrainval].splice(randomcard,1))),browseMode?browseResult():loadCard())}function ishard(){checkerTweenActive||(1==chosencard.trainval?newtrainval=chosencard.trainval:(newtrainval=7==chosencard.trainval?3:0==chosencard.trainval?1:chosencard.trainval-1,oldtrainval=chosencard.trainval,localStorage["train"+chosencard.CardID]=""+newtrainval,0==browseMode&&(currentcards[chosencard.trainval][randomcard].trainval=newtrainval,currentcards[newtrainval].push(currentcards[chosencard.trainval][randomcard]),currentcards[oldtrainval].splice(randomcard,1))),browseMode?browseResult():loadCard())}function isunsure(){checkerTweenActive||(0==chosencard.trainval?(newtrainval=1,oldtrainval=chosencard.trainval,localStorage["train"+chosencard.CardID]=""+newtrainval,0==browseMode&&(currentcards[chosencard.trainval][randomcard].trainval=newtrainval,currentcards[newtrainval].push(currentcards[chosencard.trainval][randomcard]),currentcards[oldtrainval].splice(randomcard,1))):newtrainval=chosencard.trainval,browseMode?browseResult():loadCard())}function browseResult(){browselist.splice(randomcard,1),0==browselist.length?($("body").pagecontainer("change","#deckselect"),$("#deckselect").one("pagecontainershow",function(){$("#AllBrowsedPopup").popup("open",{positionTo:"window"})})):loadCard()}function animate(e){if(1==undoFlag)undo();else{parsedPS=[],parsedPS=parsePlayString(e);for(var t=0;t<parsedPS.length;t++)bglog.move(parsedPS[t].FromPoint,parsedPS[t].ToPoint,1);undoFlag=!0}}function undo(){bglog.undoMove(),$(".movebutton").removeClass("ui-disabled"),$(".movebutton").removeClass("ui-icon-carat-l"),$(".movebutton").addClass("ui-icon-carat-r"),undoFlag=!1}function parsePlayString(e){for(var t=1,o=e.replace(/bar/gi,"25"),n=o.replace(/off/gi,"0"),a=n.replace(/\*/gi,"").trim(),r=a.split(" "),i=[],c=0;c<r.length;c++){if(i[c]=r[c].split("/"),i[c][1].indexOf("(")>-1){var s=i[c][1].indexOf("(");t=Number(i[c][1][s+1]);var d=i[c][1].slice(0,s);i[c][1]=d}else t=1;for(var l=0;t>l;l++)parsedPS[parsedPS.length]=new makeParsedPS(Number(i[c][0])-1,Number(i[c][1])-1)}return parsedPS}function makeParsedPS(e,t){this.FromPoint=e,this.ToPoint=t}function fbswap(){swapSidesFlag?($("#swapButton").removeClass("ui-icon-back"),$("#swapButton").addClass("ui-icon-forward")):($("#swapButton").removeClass("ui-icon-forward"),$("#swapButton").addClass("ui-icon-back")),bglog.swapSides()}function clearLS(){window.localStorage.clear()}function openHint(){$("body").pagecontainer("change","#hint"+chosencard.hintlist[0],{transition:"slide"})}function openStore(){$("body").pagecontainer("change","#store",{transition:"pop"}),"Initialized"!=sessionStorage.storeInit&&initStore()}function otherHeaderFunction(){var e=$(".ui-page-active").jqmData("title");"Select Deck"==e||"Flashcard"==e?$("body").pagecontainer("change","#settings",{transition:"pop"}):window.history.back()}function changeGlobalTheme(e){function t(e,t,n){$(e).removeClass(o.split(" ").join(" "+t+"-")).addClass(t+"-"+n).attr("data-theme",n)}var o=" a b c d e";t(".ui-mobile-viewport","ui-overlay",e),t("[data-role='page']","ui-body",e),t("[data-role='page']","ui-page-theme",e),t("[data-role='page']","ui-overlay-theme",e),t("[data-role='header']","ui-bar",e),t("[data-role='footer']","ui-bar",e),t("[data-role='collapsibleset']","ui-bar",e),t("[data-role='listview'] > li","ui-bar",e),t(".ui-page","background",e),t(".ui-btn","ui-btn-up",e),t(".ui-btn","ui-btn-hover",e)}for(var selecteddecks=[],checked=[],browselist=[],currentcards=[],decklist=[],hintlist=[],fbDeckSetForSale=[],i=0;8>i;i++)currentcards[i]=[];var chosencard={},chosenposition={},parsedPS=[],randomcard="",questiontext="",answertext=[],train=0,oldtrainval=0,newtrainval=0,currenttraining=0,randomcard=0,unseencount=0,learnedcount=0,trainingcount=0,lastcard=-1,trainingsizelow=10,trainingsizehigh=20,defaultThemeName="theme1",fbTheme=defaultThemeName,fbShowPointNumbers=!0,fbShowPipcount=!0,fbShowDice=!0,fbDirection=!0,fbUITheme=!0,fbAnimation=.5,fbShowTakiPoints=!0,clearTrainingFlag=!1,settingsChangeFlag=!1,themeChangeFlag=!0,numberOfThemes=3,undoFlag=!1,showingAnswer=!1,isMobile=!0,browseMode=!1,fbCoach="True",productPrefix="ts3.";$("#hard").on("vclick",function(){ishard()}),$("#unsure").on("vclick",function(){isunsure()}),$("#easy").on("vclick",function(){iseasy()}),$("#reset").on("vclick",function(){loadCard()}),$("#cleartrain").on("vclick",function(){clearTrainingKeys()}),$("#tostats").on("vclick",function(){showStats()}),$("#trainStart").on("vclick",function(){browseMode=!1,showloader("deckselect",selectDecks)}),$("#browseStart").on("vclick",function(){$("body").chardinJs("stop"),browseMode=!0,showloader("deckselect",selectDecks)
}),$("#submitSettings").on("vclick",function(){showloader("settings",readUiSettings)}),$("#swapButton").on("vclick",function(){return fbswap(),!1}),$("#questioncontainer").on("vclick",function(){toggleAnswerContainer()}),$("#clearLS").on("vclick",function(){clearLS()}),$("#hintButton").on("vclick",function(){openHint()}),$("#restorePurchases").on("vclick",function(){restorePurchases()}),$("#toTour").on("vclick",function(){$("#Tour").collapsible(),$("#Tour").collapsible("expand")}),$("#homeHeaderButton").on("vclick",function(){$("body").pagecontainer("change","#deckselect",{transition:"pop",reverse:"true"})}),$("#otherHeaderButton").on("vclick",function(){otherHeaderFunction()}),$(".buying").on("vclick",function(){if(window.isphone){var e=""+productPrefix+this.id.slice(-1);store.order(e)}else alert("Desktop sim of buying deck "+this.id.slice(-1)),afterBuy(this.id.slice(-1))}),$("[data-role='header'], [data-role='footer']").toolbar({theme:"a"}),$(document).on("pagecontainershow",function(){var e=$(".ui-page-active").jqmData("title");$("[data-role='header'] h1").text("Flashcard"!=e?e:""+Deck[chosencard.decklist[0]].DeckName),"Select Deck"==e?$("#homeHeaderButton").addClass("ui-disabled"):$("#homeHeaderButton").removeClass("ui-disabled"),"Select Deck"==e||"Flashcard"==e?($("#otherHeaderButton").removeClass("ui-icon-back"),$("#otherHeaderButton").addClass("ui-icon-gear")):($("#otherHeaderButton").removeClass("ui-icon-gear"),$("#otherHeaderButton").addClass("ui-icon-back")),"Select Deck"==e?($("#settingsNavbar").hide(),$("#cardNavbar").hide(),$("#deckNavbar").show()):"Settings"==e?($("#deckNavbar").hide(),$("#cardNavbar").hide(),$("#settingsNavbar").show()):"Flashcard"==e?($("#deckNavbar").hide(),$("#settingsNavbar").hide(),$("#cardNavbar").show()):($("#deckNavbar").hide(),$("#settingsNavbar").hide(),$("#cardNavbar").hide())}),$(document).on("pagecontainertransition",function(){"True"==fbCoach&&(chosencard.CardKind>1&&$("#questioncontainer").attr("data-position","bottom"),setTimeout(function(){$("#flashcards").chardinJs("start")},100),localStorage.fbCoach="False",fbCoach="False")}),init()}$(document).ready(function(){$("#settingsNavbar").hide(),$("#cardNavbar").hide(),window.isphone=!1;var e=navigator.userAgent.toLowerCase();window.isphone=e.indexOf("mobile")>-1||e.indexOf("android")>-1,window.isphone?document.addEventListener("deviceready",onDeviceReady,!1):onDeviceReady()});