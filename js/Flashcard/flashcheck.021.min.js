function onDeviceReady(){function init(){editMode=false;bglogInitFlag=false;if(window.isphone){setTimeout(function(){navigator.splashscreen.hide()},0)}startIscroll();loadSettings();markSettings();try{eval(fbTheme)}catch(e){console.log(e.message);fbTheme=defaultThemeName}setTimeout(function(){doTheme(eval(fbTheme));applySettings()},300);createDeckMenu();if(localStorage.selecteddecks){var decksplit=localStorage.selecteddecks.split(",");restoreSavedDecks(decksplit)}if(localStorage.DSCheck!="true"){var popup=setInterval(function(){$("#InitialDS").popup("open");clearInterval(popup)},1)}}function startIscroll(){if(window.isphone){$(".willScroll").attr("data-iscroll","");$("[data-iscroll]").iscrollview();$("[data-iscroll]").iscrollview("refresh")}}function createDeckMenu(){for(var e=DeckSet.length;e>0;e--){i=e-1;var t='<fieldset data-role="collapsible" data-theme="a" data-content-theme="a" data-corners="false" class="decksetclass" id="'+DeckSet[i].DeckSetName+'"><legend>'+DeckSet[i].DeckSetName+'</legend><div data-role="controlgroup" data-corners="false" class="insidedecksetclass" id="Inside'+i+'"></div></fieldset>';$(t).prependTo("#selectDeckForm");for(var n=0;n<Deck.length;n++){if(Deck[n].DeckSetID==i){var r='<input type="checkbox" name="Deck'+n+'" id="Deck'+n+'" /><label for="Deck'+n+'">'+Deck[n].DeckName+"</label>";$(r).appendTo("#Inside"+i)}}}$(".insidedecksetclass").enhanceWithin();$(".insidedecksetclass").controlgroup({corners:false});$(".decksetclass").collapsible()}function loadSettings(){if(localStorage.fbTheme)fbTheme=localStorage.fbTheme;if(localStorage.fbAnimation)fbAnimation=Number(localStorage.fbAnimation);if(localStorage.fbDirection=="false")fbDirection=false;if(localStorage.fbShowDice=="false")fbShowDice=false;if(localStorage.fbShowPipcount=="false")fbShowPipcount=false;if(localStorage.fbShowPointNumbers=="false"){fbShowPointNumbers=false;console.log("fbShowPointNumbers = "+fbShowPointNumbers+" "+typeof fbShowPointNumbers)}if(localStorage.fbShowTakiPoints=="false")fbShowTakiPoints=false}function markSettings(){setTimeout(function(){$("#settings").page();$("input:radio[name='fbTheme']").each(function(){$(this).prop("checked",false)});$("input:radio[name='fbTheme'][value ='"+fbTheme+"']").prop("checked",true).checkboxradio("refresh");$("input:radio[name='fbDirection']").each(function(){$(this).prop("checked",false)});$("input:radio[name='fbDirection'][value ='"+fbDirection+"']").prop("checked",true).checkboxradio("refresh");$("#fbShowDice").prop("checked",fbShowDice).checkboxradio("refresh");$("#fbShowPipcount").prop("checked",fbShowPipcount).checkboxradio("refresh");$("#fbShowPointNumbers").prop("checked",fbShowPointNumbers).checkboxradio("refresh");$("#fbShowTakiPoints").prop("checked",fbShowTakiPoints).checkboxradio("refresh");$("#fbAnimation").slider();$("#fbAnimation").val(100-fbAnimation*50);$("#fbAnimation").slider("refresh")},200)}function readUiSettings(){console.log("Reading Settings");themeChangeFlag=false;settingsChangeFlag=false;var e=$('input[name="fbTheme"]:checked').val();console.log("Theme: "+typeof e+e);if(fbTheme!=e){fbTheme=e;localStorage.fbTheme=fbTheme;themeChangeFlag=true}var t=(100-$("#fbAnimation").val())/50;console.log("Animation: "+t);if(fbAnimation!=t){fbAnimation=t;localStorage.fbAnimation=""+fbAnimation;settingsChangeFlag=true}var n=$('input[name="fbDirection"]:checked').val();if(n=="true")n=true;else n=false;console.log("Direction: "+typeof n+n);if(fbDirection!=n){fbDirection=n;console.log("fbDirection saved as "+fbDirection);localStorage.fbDirection=""+fbDirection;settingsChangeFlag=true}var r=$("#fbShowDice").is(":checked");console.log("Dice: "+typeof r+r);if(fbShowDice!=r){fbShowDice=r;localStorage.fbShowDice=""+fbShowDice;settingsChangeFlag=true}var i=$("#fbShowPipcount").is(":checked");console.log("Pips: "+typeof i+i);if(fbShowPipcount!=i){fbShowPipcount=i;localStorage.fbShowPipcount=""+fbShowPipcount;settingsChangeFlag=true}var s=$("#fbShowPointNumbers").is(":checked");console.log("Points: "+typeof s+s);if(fbShowPointNumbers!=s){fbShowPointNumbers=s;localStorage.fbShowPointNumbers=""+fbShowPointNumbers;settingsChangeFlag=true}var o=$("#fbShowTakiPoints").is(":checked");console.log("Taki: "+typeof o+o);if(fbShowTakiPoints!=o){fbShowTakiPoints=o;localStorage.fbShowTakiPoints=""+fbShowTakiPoints;settingsChangeFlag=true}if($("#fbShowInitialHelp").is(":checked")){localStorage.DSCheck="";localStorage.FCCheck="";console.log("DSCheck and FCCheck = ''");$("#fbShowInitialHelp").prop("checked",false).checkboxradio("refresh");settingsChangeFlag=true}console.log("settingsChangeFlag = "+settingsChangeFlag);console.log("themeChangeFlag = "+themeChangeFlag);if(themeChangeFlag){changeTheme(fbTheme);applySettings()}else if(settingsChangeFlag)applySettings();themeChangeFlag=false;settingsChangeFlag=false;$.mobile.back()}function applySettings(){changeAnimation(fbAnimation);changeDirection(fbDirection);changeDice(fbShowDice);changePipCount(fbShowPipcount);changePointNumbers(fbShowPointNumbers);changeTakiPoints(fbShowTakiPoints)}function changeTheme(themeName){console.log("Changing theme");if(swapSidesFlag)swapSides();doTheme(eval(themeName));showQuestion()}function changeAnimation(e){setAnimationSpeed(e)}function changeDirection(e){if(e==true){thisTheme.direction=false}else{thisTheme.direction=true}toggleDirection()}function changePipCount(e){if(e==true)thisTheme.showPipCount=false;else thisTheme.showPipCount=true;if(e==true||showingAnswer==false)togglePipCount()}function changeDice(e){if(e==true)thisTheme.showDice=false;else thisTheme.showDice=true;toggleDice()}function changePointNumbers(e){if(e==true)thisTheme.showPointNumbers=false;else thisTheme.showPointNumbers=true;toggleShowNumbers()}function changeTakiPoints(e){if(e==true)thisTheme.takiPoints=false;else thisTheme.takiPoints=true;toggletakiPoints()}function restoreSavedDecks(e){for(var t=0;t<e.length;t++){restoreSavedDeck(e[t])}}function restoreSavedDeck(e){$(e).prop("checked",true).checkboxradio("refresh")}function clearTrainingKeys(){for(var e in localStorage){if(isTrainingKey(e)){delete window.localStorage[e]}}$("#ConfirmClearTraining").popup("open");clearTrainingFlag=true;selectDecks();showStats()}function isTrainingKey(e){return e.indexOf("train")>-1}function showStats(){$("#stattext").empty();$("body").pagecontainer("change","#stats",{transition:"pop"});var e="";for(var t=0;t<checked.length;t++){e=checked[t].replace(/^\D+/g,"");if(t==0){statrow="<tr><td width = '180'><b>Selected Decks: </b></td><td colspan='2'>"+Deck[e].DeckName+"</td></tr>";$("#stattext").append(statrow)}else{statrow="<tr><td> </td><td colspan='2'>"+Deck[e].DeckName+"</td></tr>";$("#stattext").append(statrow)}}statrow="<tr><td></td><td width = '10'></td></tr>";$("#stattext").append(statrow);$("#stattext").append(statrow);var n=unseencount+learnedcount+trainingcount;statrow="<tr><td><b>Selected Cards: </b></td><td>"+n+"</td></tr>";$("#stattext").append(statrow);statrow="<tr><td> </td></tr>";$("#stattext").append(statrow);$("#stattext").append(statrow);for(var t=0;t<8;t++){if(t==0){statrow="<tr><td>Unseen cards: </td><td>"+currentcards[t].length+"</td></tr><tr></tr>";$("#stattext").append(statrow)}else if(t==7){statrow="<tr></tr><tr><td>Learned cards: </td><td>"+currentcards[t].length+"</td></tr>";$("#stattext").append(statrow)}else{statrow="<tr><td>Cards in group "+t+":</td><td>&nbsp</td><td>"+currentcards[t].length+"</td></tr>";$("#stattext").append(statrow)}}}function showloader(e,t){$("#"+e).spin("custom","black");setTimeout(function(){t();$("#"+e).spin(false)},0);return}function transition(){$("body").pagecontainer("change","#flashcards");return}function selectDecks(){checked.length=0;selecteddecks.length=0;for(var e=0;e<Deck.length;e++){if($("#Deck"+e).prop("checked")==true){checked.push("Deck"+e);selecteddecks.push("#Deck"+e)}}if(checked.length==0){$("#NoneSelectedPopup").popup("open")}else{selectCards()}localStorage.selecteddecks=""+selecteddecks.toString();return}function selectCards(){browselist=[];for(var e=0;e<Card.length;e++){if(decklist in Card[e]){card[e].decklist.length=0}if(hintlist in Card[e]){card[e].hintlist.length=0}}for(var e=0;e<8;e++){currentcards[e].length=0}for(var e=0;e<CardInDeck.length;e++){if(checked.indexOf("Deck"+CardInDeck[e].DeckID)>-1){if(!(decklist in Card[CardInDeck[e].CardID])){Card[CardInDeck[e].CardID].decklist=[]}Card[CardInDeck[e].CardID].decklist.push(CardInDeck[e].DeckID);if(!(hintlist in Card[CardInDeck[e].CardID])){Card[CardInDeck[e].CardID].hintlist=[]}Card[CardInDeck[e].CardID].hintlist.push(CardInDeck[e].DeckHintPointer);browselist[browselist.length]=Card[CardInDeck[e].CardID];if(localStorage["train"+e]){train=Number(localStorage["train"+e]);Card[CardInDeck[e].CardID].trainval=train;currentcards[train][currentcards[train].length]=Card[CardInDeck[e].CardID]}else{train=0;Card[CardInDeck[e].CardID].trainval=0;currentcards[0][currentcards[0].length]=Card[CardInDeck[e].CardID]}}}console.log("Browselist length: "+browselist.length);if(clearTrainingFlag==false)loadCard();else clearTrainingFlag=false;return}function loadCard(){$("body").pagecontainer("change","#flashcards",{transition:"pop"});undo();if(browseMode)browsecard();else{choosecard();lastcard=chosencard.CardID}chooseposition();$("#questioncontainer").css("text-align","left");$("#questioncontainer").removeClass("ui-icon-minus");$("#questioncontainer").addClass("ui-icon-plus");if(fbShowPipcount==false&&showingAnswer==true)togglePipCount();if(swapSidesFlag)swapSides();if(chosencard.CardKind==0){$("#swapButton").show()}else{$("#swapButton").hide()}if(chosencard.CardKind==2){$("#bglogContainer").slideUp()}else{$("#bglogContainer").slideDown();loadXgId("XGID="+chosenposition.XGID)}$("#outerAnswerContainer").hide();showingAnswer=false;$("#flashcardheader").text(""+Deck[chosencard.decklist[0]].DeckName+"");showQuestion();showAnswer();return}function showQuestion(){var e=thisTheme.ourCheckerColorText;var t="";var n="";var r="";if(chosencard.CardKind==2){if(chosenposition.iNeed>chosenposition.youNeed){r=" leads: "}else if(chosenposition.iNeed<chosenposition.youNeed){r=" trails: "}else{r=" is even: ";e="Match"}if(chosenposition.iNeed==-1||chosenposition.youNeed==-1){t=", Crawford"}n=e+r+chosenposition.iNeed+", "+chosenposition.youNeed+t+".";if(chosenposition.Concepttype=="TP"){questiontext=n+"<br>"+thisTheme.ourCheckerColorText+" is doubled to "+chosenposition.Cube+".  Take point?"}if(chosenposition.Concepttype=="MWC"){questiontext=n+"<br>Match Winning Chances?"}}else{if(matchLength==0){n="Money game."}else{var i=ourScore-matchLength;var s=oppScore-matchLength;if(ourScore>oppScore){r="leads:"}else if(ourScore<oppScore){r="trails:"}else{r="is even:"}if(crawfordFlag){t=", Crawford"}else{t=""}n=" "+thisTheme.ourCheckerColorText+" "+r+" "+i+", "+s+t+"."}if(chosencard.CardKind==0){questiontext=thisTheme.ourCheckerColorText+" on roll, Cube Action?<br>"+n}else if(chosencard.CardKind==1){questiontext=thisTheme.ourCheckerColorText+" to play "+leftDie+rightDie+".<br>"+n}}$("#questioncontainer").html(questiontext);return}function showAnswer(){$(".answerContainer div .iscroll-content").empty();if(chosencard.CardKind==0){showCubeAnswer()}else if(chosencard.CardKind==1){showPlayAnswer()}else if(chosencard.CardKind==2){showConceptAnswer()}var e="";for(var t=0;t<answertext.length;t++){e+=answertext[t]}e+="<br><br><br><br><br><br>";$(".answerContainer div .iscroll-content").append(e);$(".answerContainer").iscrollview("scrollTo",0,0,0,false);$(".movebutton").click(function(e){$(".movebutton").not(this).addClass("ui-disabled");$(this).removeClass("ui-icon-carat-r");$(this).addClass("ui-icon-carat-l");animate($(this).text());return false});return}function toggleAnswerContainer(){if(fbShowPipcount==false)togglePipCount();if(showingAnswer){$("#outerAnswerContainer").hide();$("#questioncontainer").removeClass("ui-icon-minus");$("#questioncontainer").addClass("ui-icon-plus");showingAnswer=false}else{$("#outerAnswerContainer").show();$("#questioncontainer").removeClass("ui-icon-plus");$("#questioncontainer").addClass("ui-icon-minus");showingAnswer=true}$(".answerContainer").iscrollview("refresh");return}function showCubeAnswer(){answertext=[];cubeDataNum=getCubeData();cubeActions=getCubeActions(cubeDataNum);cubeData=formatCubeData(cubeDataNum,cubeActions);cubeOutcomes=getCubeOutcomes();answertext[answertext.length]="<table><tr><td width='130'></td><td width='65'></td><td width='65'></td><td></td></tr>";if(matchLength>0){answertext[answertext.length]="<tr><td><b>Score:</b></td><td colspan='3' style='text-align:left'><b>"+cubeActions.scoreDouble+" / "+cubeActions.scoreTake+"</b></td></tr>";answertext[answertext.length]="<tr><td>No Double</td><td>"+cubeData.scoreND+"</td><td>"+cubeData.scoreNDEr+"</tr>";answertext[answertext.length]="<tr><td>Double/Take</td><td>"+cubeData.scoreDT+"</td><td>"+cubeData.scoreDTEr+"</tr>";answertext[answertext.length]="<tr><td>Double/Pass</td><td>+1.000</td><td>"+cubeData.scoreDPEr+"</tr>";answertext[answertext.length]="<tr><td colspan='100'><hr></td></tr><tr></tr>"}answertext[answertext.length]="<tr><td><b>Money:</b></td><td colspan='3' style='text-align:left'><b>"+cubeActions.moneyCombo+" / "+cubeActions.moneyTake+"</b></td></tr>";if(cubeActions.moneyCombo=="No Double (Redouble)"){answertext[answertext.length]="<tr><td></td><td colspan='3' style='text-align:left'><b>Lotto Paradox!</b></td></tr>"}answertext[answertext.length]="<tr><td><b>W:</b> "+cubeOutcomes.PlainW+" ("+cubeOutcomes.GammonW+", "+cubeOutcomes.BackgammonW+")</td><td colspan='3'><b>L:</b> "+cubeOutcomes.PlainL+" ("+cubeOutcomes.GammonL+", "+cubeOutcomes.BackgammonL+")</td></tr>";answertext[answertext.length]="<tr><td>No Double</td><td>"+cubeData.moneyND+"</td><td>"+cubeData.moneyNDEr+"</tr>";answertext[answertext.length]="<tr><td>No Redouble</td><td>"+cubeData.moneyNRD+"</td><td>"+cubeData.moneyNRDEr+"</tr>";answertext[answertext.length]="<tr><td>Double/"+cubeActions.moneyTakeString+"</td><td>"+cubeData.moneyDT+"</td><td>"+cubeData.moneyDTEr+"</tr>";answertext[answertext.length]="<tr><td>Double/Pass</td><td>+1.000</td><td>"+cubeData.moneyDPEr+"</tr></table>";return answertext}function getCubeOutcomes(){var e=[];e.PlainW=Outcome[0][chosenposition.positionIndex].PlainW;e.GammonW=Outcome[0][chosenposition.positionIndex].GammonW;e.BackgammonW=Outcome[0][chosenposition.positionIndex].BackgammonW;e.PlainL=Outcome[0][chosenposition.positionIndex].PlainL;e.GammonL=Outcome[0][chosenposition.positionIndex].GammonL;e.BackgammonL=Outcome[0][chosenposition.positionIndex].BackgammonL;return e}function getCubeData(){var e=[];for(var t=0,n=CubeCard[chosencard.CardID].length;t<n;t++){if(CubePosition[CubeCard[chosencard.CardID][t]].Score1==0){e.moneyDT=CubePosition[CubeCard[chosencard.CardID][t]].DTEq;if(CubePosition[CubeCard[chosencard.CardID][t]].CubeOwner==0){e.moneyND=CubePosition[CubeCard[chosencard.CardID][t]].NDEq}else{e.moneyNRD=CubePosition[CubeCard[chosencard.CardID][t]].NDEq}}else{e.scoreND=CubePosition[CubeCard[chosencard.CardID][t]].NDEq;e.scoreDT=CubePosition[CubeCard[chosencard.CardID][t]].DTEq}}e.moneyNDEr=(e.moneyND-Math.min(e.moneyDT,1)).toFixed(3);e.moneyNRDEr=(e.moneyNRD-Math.min(e.moneyDT,1)).toFixed(3);e.scoreNDEr=(e.scoreND-Math.min(e.scoreDT,1)).toFixed(3);if(e.moneyNRD>1){e.moneyDPEr=(1-e.moneyNRD).toFixed(3)}else{e.moneyDPEr=(1-e.moneyDT).toFixed(3)}if(e.scoreND>1){e.scoreDPEr=(1-e.scoreND).toFixed(3)}else{e.scoreDPEr=(1-e.scoreDT).toFixed(3)}if(e.moneyDT>1){e.moneyDTEr=(e.moneyDT-Math.max(e.moneyNRD,1)).toFixed(3)}else{e.moneyDTEr=(e.moneyDT-e.moneyNRD).toFixed(3)}if(e.scoreDT>1){e.scoreDTEr=(e.scoreDT-Math.max(e.scoreND,1)).toFixed(3)}else{e.scoreDTEr=(e.scoreDT-e.scoreND).toFixed(3)}return e}function formatCubeData(e,t){for(datum in e){if(e[datum]>=0){e[datum]="+"+e[datum]}else e[datum]="- "+e[datum]*-1}if(t.moneyTake=="Pass"){if(t.moneyReDouble=="Too Good"){e.moneyNRDEr=""}else{e.moneyDPEr=""}}if(t.moneyTake=="Beaver"){e.moneyNDEr="";e.moneyNRDEr=""}if(t.moneyTake=="Take"){if(t.moneyDouble=="Double"||t.moneyReDouble=="Redouble"){e.moneyDTEr=""}if(t.moneyDouble=="No Double"){e.moneyNDEr=""}if(t.moneyReDouble=="No Redouble"){e.moneyNRDEr=""}}if(t.moneyDouble=="Too Good"){e.moneyNRDEr=""}if(t.scoreTake=="Pass"){if(t.scoreDouble=="Too Good"){e.scoreNDEr=""}else{e.scoreDPEr=""}}if(t.scoreTake=="Take"){if(t.scoreDouble=="Double"){e.scoreDTEr=""}else{e.scoreNDEr=""}}if(e.moneyNRDEr!=""){e.moneyNRDEr="("+e.moneyNRDEr+")"}if(e.moneyNDEr!=""){e.moneyNDEr="("+e.moneyNDEr+")"}if(e.moneyDTEr!=""){e.moneyDTEr="("+e.moneyDTEr+")"}if(e.moneyDPEr!=""){e.moneyDPEr="("+e.moneyDPEr+")"}if(e.scoreNDEr!=""){e.scoreNDEr="("+e.scoreNDEr+")"}if(e.scoreDTEr!=""){e.scoreDTEr="("+e.scoreDTEr+")"}if(e.scoreDPEr!=""){e.scoreDPEr="("+e.scoreDPEr+")"}return e}function getCubeActions(e){var t=[];if(e.moneyNRD<e.moneyDT){if(e.moneyNRD>1){t.moneyReDouble="Too Good"}else{t.moneyReDouble="Redouble"}}else{t.moneyReDouble="No Redouble"}if(e.moneyND<e.moneyDT){t.moneyDouble="Double"}else{t.moneyDouble="No Double"}if(t.moneyDouble=="No Double"){if(t.moneyReDouble=="No Redouble"){t.moneyCombo="No (Re)Double"}else{t.moneyCombo="No Double (Redouble)"}}else{if(t.moneyReDouble=="No Redouble"){t.moneyCombo="Double (No Redouble)"}else if(t.moneyReDouble=="Redouble"){t.moneyCombo="(Re)Double"}else{t.moneyCombo="Double (Too Good)"}}if(e.moneyDT>=1){t.moneyTake="Pass";t.moneyTakeString="Take"}else{if(e.moneyDT<0){t.moneyTake="Beaver";t.moneyTakeString="Beaver"}else{t.moneyTake="Take";t.moneyTakeString="Take"}}if(e.scoreND<e.scoreDT){if(e.scoreND>1){t.scoreDouble="Too Good"}else{t.scoreDouble="Double"}}else{t.scoreDouble="No Double"}if(e.scoreDT>=1){t.scoreTake="Pass"}else{t.scoreTake="Take"}return t}function showPlayAnswer(){answertext=[];answertext[answertext.length]="<table cellpadding='0' cellspacing='0'><tr><td width='60'></td><td width='150'></td><td width='20'></td><td></td><td></td></tr>";if(matchLength>0){var e=getPlayResults(chosenposition.positionIndex,"Score");answertext[answertext.length]="<tr><td colspan='100'><hr></td></tr><tr></tr>";var t=getPlayResults(getMoneyPlayPosition(),"Money");answertext=t;answertext[answertext.length]="</table>"}else{var n=getPlayResults(chosenposition.positionIndex,"Money");answertext=n;answertext[answertext.length]="</table>"}return answertext}function getPlayResults(e,t){for(var n=0,r=Object.keys(Play[e]).length;n<r;n++){if(n==0){var i="";var s=Play[e][n].PlayString;var o=Play[e][n].PlayEquity;if(Play[e][n].PlayEquity<0){i="-";o=Math.abs(o)}answertext[answertext.length]="<tr><td><strong>"+t+":&nbsp;</strong></td><td><div class='ui-btn ui-mini ui-icon-carat-r ui-btn-icon-right ui-corner-all fastclick movebutton' style='width:70%;text-align:left;margin:3px;'>"+s+"</div></td><td></td><td>"+i+"</td><td><strong>"+o+"</strong></td></tr>"}else{var u=Play[e][0].PlayEquity-Play[e][n].PlayEquity;var a=u.toFixed(3);answertext[answertext.length]="<tr><td></td><td><div class='ui-btn ui-mini ui-icon-carat-r ui-btn-icon-right ui-corner-all fastclick movebutton' style='width:70%;text-align:left;margin:3px'>"+Play[e][n].PlayString+"</div></td><td></td><td>(-</td><td>"+a+")</td></tr>"}}return answertext}function getMoneyPlayPosition(){for(var e in PlayCard[chosencard.CardID]){if(PlayPosition[PlayCard[chosencard.CardID][e]].Score1==0){return PlayCard[chosencard.CardID][e]}}}function showConceptAnswer(){answertext=[];if(chosenposition.Concepttype=="TP"){answertext[answertext.length]="<table><tr><td width='100'></td><td width='150'></td><td></td></tr>";answertext[answertext.length]="<tr><td><b>Take Point:</b></td><td><b>Dead Cube</b></td><td><b>Live Cube</b></td></tr>";answertext[answertext.length]="<tr><td></td><td>"+chosenposition.Dead+"%</td><td>"+chosenposition.Live+"%</td></tr></table>"}else if(chosenposition.Concepttype=="MWC"){answertext[answertext.length]="<table><tr><td width='100'></td><td width='150'></td><td></td></tr>";answertext[answertext.length]="<tr><td><b>MWC:</b></td><td>"+chosenposition.Dead+"%</td><td></td></tr></table>"}return answertext}function chooseposition(){if(chosencard.CardKind==0){chosenposition=jQuery.extend(true,{},CubePosition[CubeCard[chosencard.CardID][0]]);chosenposition.positionIndex=CubeCard[chosencard.CardID][0];$("#swapButton").show()}else if(chosencard.CardKind==1){chosenposition=jQuery.extend(true,{},PlayPosition[PlayCard[chosencard.CardID][0]]);chosenposition.positionIndex=PlayCard[chosencard.CardID][0];$("#swapButton").hide()}else if(chosencard.CardKind==2){chosenposition=jQuery.extend(true,{},ConceptCard[chosencard.CardID]);chosenposition.positionIndex=chosencard.CardID}return}function browsecard(){chosencard={};randomcard=Math.floor(Math.random()*browselist.length);chosencard=jQuery.extend(true,{},browselist[randomcard]);return}function choosecard(){do{traingroup=choosegroup();chosencard={};if(traingroup=="Unseen"){randomcard=Math.floor(Math.random()*unseencount);chosencard=jQuery.extend(true,{},currentcards[0][randomcard])}else if(traingroup=="Learned"){randomcard=Math.floor(Math.random()*learnedcount);chosencard=jQuery.extend(true,{},currentcards[7][randomcard])}else{var e=[];e[0]=0;var t=0;for(var n=1;n<7;n++){e[n]=e[n-1]+currentcards[n].length*(7-n)}t=Math.floor(Math.random()*e[6]+1);for(var n=1;n<7;n++){if(t<=e[n]){randomcard=Math.floor(Math.random()*currentcards[n].length);chosencard=jQuery.extend(true,{},currentcards[n][randomcard]);break}}}}while(chosencard.CardID==lastcard);return}function choosegroup(){traingroup="";unseencount=currentcards[0].length;learnedcount=currentcards[7].length;trainingcount=0;for(var e=1;e<7;e++){trainingcount=trainingcount+currentcards[e].length}if(unseencount==0){if(trainingcount==0){if(learnedcount==0){$("body").pagecontainer("change","#checkbox")}else{traingroup="Learned"}}else{if(learnedcount==0){traingroup="Training"}else{if(Math.random()<.95){traingroup="Training"}else{traingroup="Learned"}}}}else{if(trainingcount<trainingsizelow){traingroup="Unseen"}else if(trainingcount<trainingsizehigh){if(Math.random()<.5){traingroup="Training"}else{traingroup="Unseen"}}else{if(learnedcount==0){traingroup="Training"}else{if(Math.random()<.95){traingroup="Training"}else{traingroup="Learned"}}}}return traingroup}function iseasy(){if(checkerTweenActive)return;if(chosencard.trainval==7){newtrainval=chosencard.trainval}else{oldtrainval=chosencard.trainval;newtrainval=chosencard.trainval+1;localStorage["train"+chosencard.CardID]=""+newtrainval;if(browseMode==false){currentcards[chosencard.trainval][randomcard].trainval=newtrainval;currentcards[newtrainval].push(currentcards[chosencard.trainval][randomcard]);currentcards[oldtrainval].splice(randomcard,1)}}if(browseMode)browseResult();else loadCard();return}function ishard(){if(checkerTweenActive)return;if(chosencard.trainval==1){newtrainval=chosencard.trainval}else{if(chosencard.trainval==7){newtrainval=3}else if(chosencard.trainval==0){newtrainval=1}else{newtrainval=chosencard.trainval-1}oldtrainval=chosencard.trainval;localStorage["train"+chosencard.CardID]=""+newtrainval;if(browseMode==false){currentcards[chosencard.trainval][randomcard].trainval=newtrainval;currentcards[newtrainval].push(currentcards[chosencard.trainval][randomcard]);currentcards[oldtrainval].splice(randomcard,1)}}if(browseMode)browseResult();else loadCard();return}function isunsure(){if(checkerTweenActive)return;if(chosencard.trainval==0){newtrainval=1;oldtrainval=chosencard.trainval;localStorage["train"+chosencard.CardID]=""+newtrainval;if(browseMode==false){currentcards[chosencard.trainval][randomcard].trainval=newtrainval;currentcards[newtrainval].push(currentcards[chosencard.trainval][randomcard]);currentcards[oldtrainval].splice(randomcard,1)}}else{newtrainval=chosencard.trainval}if(browseMode)browseResult();else loadCard();return}function browseResult(){browselist.splice(randomcard,1);if(browselist.length==0){$("body").pagecontainer("change","#deckselect");$("#deckselect").one("pagecontainershow",function(){$("#AllBrowsedPopup").popup("open",{positionTo:"window"})})}else loadCard();return}function animate(e){if(undoFlag==true){undo()}else{parsedPS=[];parsedPS=parsePlayString(e);for(var t=0;t<parsedPS.length;t++){move(parsedPS[t].FromPoint,parsedPS[t].ToPoint,1)}undoFlag=true}return}function undo(){doUndo();$(".movebutton").removeClass("ui-disabled");$(".movebutton").removeClass("ui-icon-carat-l");$(".movebutton").addClass("ui-icon-carat-r");undoFlag=false;return}function parsePlayString(e){var t=1;var n=e.replace(/bar/gi,"25");var r=n.replace(/off/gi,"0");var i=r.replace(/\*/gi,"");var s=i.split(" ");var o=[];for(var u=0;u<s.length;u++){o[u]=s[u].split("/");if(o[u][1].indexOf("(")>-1){var a=o[u][1].indexOf("(");t=Number(o[u][1][a+1]);var f=o[u][1].slice(0,a);o[u][1]=f}else t=1;for(var l=0;l<t;l++){parsedPS[parsedPS.length]=new makeParsedPS(Number(o[u][0])-1,Number(o[u][1])-1)}}return parsedPS}function makeParsedPS(e,t){this.FromPoint=e;this.ToPoint=t;return}function fbswap(){if(swapSidesFlag){$("#swapButton").removeClass("ui-icon-back");$("#swapButton").addClass("ui-icon-forward")}else{$("#swapButton").removeClass("ui-icon-forward");$("#swapButton").addClass("ui-icon-back")}swapSides();return}function clearLS(){window.localStorage.clear()}function openHint(){$("body").pagecontainer("change","#hint"+chosencard.hintlist[0],{transition:"slide"})}var selecteddecks=[];var checked=[];var browselist=[];var currentcards=[];var decklist=[];var hintlist=[];for(var i=0;i<8;i++){currentcards[i]=[]}var chosencard={};var chosenposition={};var parsedPS=[];var randomcard="";var questiontext="";var answertext=[];var train=0;var oldtrainval=0;var newtrainval=0;var currenttraining=0;var randomcard=0;var unseencount=0;var learnedcount=0;var trainingcount=0;var lastcard=-1;var trainingsizelow=10;var trainingsizehigh=20;var defaultThemeName="theme1";var fbTheme=defaultThemeName;var fbShowPointNumbers=true;var fbShowPipcount=true;var fbShowDice=true;var fbDirection=true;var fbAnimation=.5;var fbShowTakiPoints=true;var clearTrainingFlag=false;var settingsChangeFlag=false;var themeChangeFlag=true;var numberOfThemes=3;var undoFlag=false;var showingAnswer=false;var isMobile=true;var browseMode=false;$("#hard").on("vclick",function(){ishard()});$("#unsure").on("vclick",function(){isunsure()});$("#easy").on("vclick",function(){iseasy()});$("#reset").on("vclick",function(){loadCard()});$("#cleartrain").on("vclick",function(){clearTrainingKeys()});$("#tostats").on("vclick",function(){showStats()});$("#trainStart").on("vclick",function(){browseMode=false;showloader("deckselect",selectDecks)});$("#browseStart").on("vclick",function(){browseMode=true;showloader("deckselect",selectDecks)});$("#submitSettings").on("vclick",function(){showloader("settings",readUiSettings)});$("#swapButton").on("vclick",function(){fbswap();return false});$("#questioncontainer").on("vclick",function(){toggleAnswerContainer()});$("#clearLS").on("vclick",function(){clearLS()});$("#hintButton").on("vclick",function(){openHint()});$("#deckselect").on("pageshow",function(e,t){if(localStorage.DSCheck!="true"){$("#InitialDS").popup("open")}});$("#flashcards").on("pageshow",function(e,t){if(localStorage.FCCheck!="true"){$("#InitialFC").popup("open")}});$("#InitialDSClose").on("vclick",function(){localStorage.DSCheck="true"});$("#InitialFCClose").on("vclick",function(){localStorage.FCCheck="true"});init();}$(document).ready(function(){window.isphone=false;var e=navigator.userAgent.toLowerCase();window.isphone=e.indexOf("mobile")>-1||e.indexOf("android")>-1;if(window.isphone){document.addEventListener("deviceready",onDeviceReady,false)}else{onDeviceReady()}});